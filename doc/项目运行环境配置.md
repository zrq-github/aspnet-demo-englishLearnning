# 项目运行环境配置

## 如何启动程序

- [配置环境变量](#配置系统环境变量)
- [配置Nginx](#配置nginx)

## 配置环境变量

### 配置系统环境变量

因为该项目主要是测试学习项目，为了方便，多个微服务统一调用系统的环境变量 “DefaultDB:ConnStr” 。  
多个微服务都从其中获取字符串数据库字符串连接。  

```powershell
# 添加到用户变量
[System.Environment]::SetEnvironmentVariable("DefaultDB:ConnStr", "Server=.;Database=aspnet-demo;Trusted_Connection=True;TrustServerCertificate=True;", "User")
# 添加到系统变量
[System.Environment]::SetEnvironmentVariable("DefaultDB:ConnStr", "Server=.;Database=aspnet-demo;Trusted_Connection=True;TrustServerCertificate=True;", "Machine")
# 两者选一个
```

### 配置数据库中的基础表数据

在数据中增加一个名字为 T_Configs 的表：  

| Id | Name | Value |
| -- | Cors | |
| -- | FileService:SMB |  |
| -- | FileService:UPYun | |
| -- | FileService:Endpoint | |
| -- | Redis | |
| -- | RabbitMQ | |
| -- | ElasticSearch | |
| -- | JWT | |

![](../images/T_Configs表配置示例.png)

Cors: 跨域，前端项目跨域问题；
FileService:SMB：文件服务器保存位置；  
FileService:UPYun：上传云（U盘云？）？没有用到，可以暂时不用配置；  
FileService:Endpoint：文件服务器的路径；  
RabbitMQ：服务器地址；  
ElasticSearch：服务器地址；  
JWT：配置设定

## SQLServer



## 配置Nginx

[nginx-down](https://nginx.org/en/download.html)

https://hub.docker.com/_/nginx

### Docker-Nginx

- 执行 git\docker\nginx\Dockerfile [生成新的镜像]((#生成新的nginx镜像))，主要是覆盖 nginx.conf 文件
- 执行 docker run --name nginx-aspnet-demo -d nginx-aspnet-demo 启动镜像

#### 生成新的Nginx镜像

docker build --pull --rm -f "docker\nginx\Dcokerfile" -t nginx-aspnet-demo "docker\nginx"

如果没法执行，可以使用VSCode安装Docker插件，右键Dockerfile文件 -> build image，在这里我给镜像命名为 nginx-aspnet-demo 

### Nginx Docker

- docker search nginx (搜索nginx)
- docker pull nginx:[nginx-version]  (下载指定版本  )
- 

## Elasticsearch